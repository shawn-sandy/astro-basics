---
import { getCollection } from "astro:content";
import { PAGINATION_COUNT } from "#utils/site-config";
import Layout from "#layouts/Layout.astro";
import BlogPosts from "#components/astro/BlogPosts.astro";
import Pagination from "#components/astro/Pagination.astro";
import type { TODO } from "#utils/types.js";
export const collection = "posts";
import AstroPages from "#components/astro/AstroPages.astro";

type Props = {
  pageSize: number;
};

export async function getStaticPaths({ paginate }) {
  const postsCollection = (await getCollection(collection, ({ data }) => {
    return data.publish === true;
  })).sort(
    (a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime()
  );
  return paginate(postsCollection, { pageSize: PAGINATION_COUNT });
}

const pageSize = PAGINATION_COUNT || 5;
const { page } = Astro.props as TODO;
---

<Layout pageTitle="Blog Posts">
  {
    page?.data.map((post: TODO) => (
      <article>
        <BlogPosts
          url={post.slug}
          title={post.data.title}
          description={post.data.description}
        />
      </article>
    ))
  }

    <!-- <div>
      {page?.url?.prev ? <a href={page?.url?.prev}>Previous</a> : ""}
    </div> -->
    <Pagination collection="posts" itemsPerPage={pageSize} currentPage={page?.currentPage} prevUrl={page?.url?.prev || undefined} nextUrl={page?.url?.next || undefined} />
    <!-- <div>
      {page?.url?.next ? <a href={page?.url?.next}>Next </a> : ""}
    </div> -->

</Layout>

<AstroPages pageSize={pageSize} collections={collection} />
